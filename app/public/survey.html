
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>FriendFinder</title>


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <!-- Font Awesome Glyphicons -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

  <!-- Chosen -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

</head>

<body>

  <div class="container-fluid">

    <h1>Survey Questions</h1>
    <a href="/"><button class="btn btn-lg btn-primary">Home</button></a>
    <hr>

    <h3><strong>About You</strong></h3>
    <h4>Name (Required)</h4>
    <input type="text" id="name" class="form-control" required>

    <h4>Link to Photo (Required)</h4>
    <input type="text" id="photo" class="form-control" required>

    <hr>

    
    <h4>1) You like pineapples on pizza.</h4>
    <select class="chosen-select" id="q1">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h4>2) You consider yourself more outgoing and actively try to put yourself in uncomfortable situations.</h4>
    <select class="chosen-select" id="q2">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>



    <h4>3) You are not very stressed, even with a deadline coming up.</h4>
    <select class="chosen-select" id="q3">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h4>4) You frequently volunteer your free time for the community you are in.</h4>
    <select class="chosen-select" id="q4">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>



    <h4>5) People can rarely upset you.</h4>
    <select class="chosen-select" id="q5">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>



    <h4>6) It is often difficult for you to relate to other people’s feelings.</h4>
    <select class="chosen-select" id="q6">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>



    <h4>7) You are honest, even when it comes at the cost of another person's emotions.</h4>
    <select class="chosen-select" id="q7">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h4>8) You rarely get carried away by fantasies and ideas.</h4>
    <select class="chosen-select" id="q8">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <h4>9) You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h4>
    <select class="chosen-select" id="q9">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>


    <h4>10) You enjoy outtings with large groups of people, rather than smaller groups.</h4>
    <select class="chosen-select" id="q10">
      <option value=""></option>
      <option value="1">1 (Strongly Disagree)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5 (Strongly Agree)</option>
    </select>

    <br>
    <br>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-danger btn-lg" id="submit">
     Submit</button>

    <hr>
    <footer class="footer">
      <div class="container">
        <p><a href="/api/friends">API Friends List</a>
      </div>
    </footer>

  </div>

  <!-- Modal -->
  <div id="results-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title"><strong>Best Match</strong></h2>
        </div>
        <div class="modal-body">
          <h2 id="match-name"></h2>
          <img id="match-img" src="https://media.licdn.com/mpr/mpr/shrinknp_400_400/p/6/005/064/1bd/3435aa3.jpg" alt="">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

  <script type="text/javascript">
    // Chosen CSS
    var config = {
      ".chosen-select": {},
      ".chosen-select-deselect": {
        allow_single_deselect: true
      },
      ".chosen-select-no-single": {
        disable_search_threshold: 10
      },
      ".chosen-select-no-results": {
        no_results_text: "nothing found"
      },
      ".chosen-select-width": {
        width: "80%"
      }
    };

    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }

    // Capture the form inputs
    $("#submit").on("click", function(event) {
      event.preventDefault();

      // Form validation
      function validation() {
        var valid = true;
        $(".form-control").each(function() {
          if ($(this).val() === "") {
            valid = false;
          }
        });

        $(".chosen-select").each(function() {

          if ($(this).val() === "") {
            valid = false;
          }
        });
        return valid;
      }

    
      if (validation()) {
       
        var userData = {
          name: $("#name").val(),
          photo: $("#photo").val(),
          scores: [
            $("#q1").val(),
            $("#q2").val(),
            $("#q3").val(),
            $("#q4").val(),
            $("#q5").val(),
            $("#q6").val(),
            $("#q7").val(),
            $("#q8").val(),
            $("#q9").val(),
            $("#q10").val()
          ]
        };
        
        // Posts the new submitted data to the API
        $.post("/api/friends", userData, function(data) {
//=================================================================================================================================================================
//New Code
var friends = require("./data/friends");
          var diff = 0;
          var scores = [];
          //When the submit button is clicked, the data is pushed up to the form, but before we push the data up, we want to compare the userData first with all the data
          //that is already in the array and run the following code.
          //This for loop will fill the empty array "scores" with the total sum of differences between the user and the people currently in the database
          for(var i = 0; i<friends.length;i++){
            for(var x = 0; x<friends[i].scores.length;x++){
                //WE can just push all the differences into an array and then grab the index with the lowest number
                diff = diff + Math.abs(userData.score[x]-friends[i].score[x]);
                scores.push(diff);
            }
          }
          //the function below takes an array and finds the index of the lowest integer
          var indexOfLow = function(arr){
            if(arr.length === 0){
                return -1;
            }
            var lowestValue = arr[0];
            var lowIndex = 0;
            for(var i = 0; i < arr.length; i++){
                if(arr[i]>max){
                  //index of the lowest number
                    lowIndex = i;
                  //value of the lowest number, which is positioned at lowIndex
                    lowestValue = arr[i];
                }
            }
          //calls the function with scores as the parameter.
          //the index that is returned corresponds to the BEST MATCH
          console.log("Index of the lowest number: "+ arr[lowIndex]);
          console.log("And their name here: "+ friends[lowIndex].name);
          return lowIndex;
          
          }

          indexOfLow(scores);
          

          //now take the index of the BEST MATCH and display the BEST MATCHES information. The best matches information is located in the "friends" array and 
          // will be inside of friends[maxIndex].name/photo

//=================================================================================================================================================================
          
          // Grab the result from the AJAX post so that the best match's name and photo are displayed.
          $("#match-name").text(friends[lowIndex].name);
          $("#match-img").attr("src", friends[lowIndex].photo);

          // Show the modal with the best match
          $("#results-modal").modal("toggle");

        });
      } else {
        alert("Please answer all questions");
      }
    });
  </script>

</body>

</html>
